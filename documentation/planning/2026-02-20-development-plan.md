# 개발 계획 (2026-02-20)

본 문서는 Factory MES를 점검한 결과와, 이에 따른 개발 계획을 정리한 것입니다.

---

## 1. 목표 정리

- **에셋(Asset)**: 공장 또는 회사의 자원을 일반화한 객체.
- **관계**: 에셋 간 관계의 **종류**, **방향 유무**, **관계에 붙는 속성**을 자유롭게 담을 수 있어야 함.
- **운영 시뮬레이션**: 위 모델을 바탕으로 운영 상황을 시뮬레이션할 수 있는 **기본 준비**가 되어 있어야 함.

---

## 2. 현재 상태 요약

| 항목                 | 상태              | 비고                                                                              |
| -------------------- | ----------------- | --------------------------------------------------------------------------------- |
| 에셋 엔티티          | ✅                | id, type, connections, metadata, createdAt/updatedAt                              |
| 에셋 단위 메타데이터 | ✅ 백엔드 / ❌ UI | API·도메인·DB 모두 `metadata`(자유 객체) 지원. 생성 폼은 항상 `metadata: {}` 전송 |
| 에셋 간 연결         | ⚠️ 제한적         | `connections`: "연결된 다른 에셋 ID 목록"만 존재                                  |
| 관계 종류            | ❌                | 관계 타입(예: feeds_into, contains) 없음                                          |
| 관계 방향            | ⚠️ 암묵적         | A가 B를 connections에 넣으면 "A→B"로 해석 가능하나 first-class 아님               |
| 관계 단위 속성       | ❌                | "이 연결의 유량·용량" 등 엣지 속성 없음                                           |
| 시뮬레이션           | ❌                | 버튼만 있고 백엔드 API/엔진 없음 ("추후 연동" 상태)                               |

**이미 준비된 것**

- 에셋 = 자원 일반화 객체로 사용 가능.
- 에셋 단위 `metadata`로 설비/자원별 속성 확장 가능 (백엔드·DB 지원).
- `connections: [id1, id2, ...]` 로 "누가 누구와 연결되는지" 표현 가능.
- 상태(states)·이벤트(events) 저장으로 시뮬레이션/분석 기반 데이터는 확보 가능.

---

## 3. 개선이 필요한 부분

### 3.1 관계 모델 확장 (우선)

- **관계 종류**: 예) "공급한다", "포함한다", "위치한다" 등 타입 구분.
- **관계 방향**: A→B vs B→A를 명시적으로 표현.
- **관계(엣지) 단위 속성**: 유량, 용량, 거리 등.

**선택지**

- **A. 관계를 별도 엔티티로 두기**  
  `Relationship`(또는 `Edge`): `fromAssetId`, `toAssetId`, `relationshipType`, `properties`(또는 `metadata`).  
  → 관계 종류·방향·관계별 속성을 모두 담기 좋음.
- **B. 에셋의 connections를 구조화**  
  `connections: [{ targetId, type?, direction?, properties? }]` 형태로 확장.  
  → 기존 `connections` 필드 진화로 마이그레이션 부담은 상대적으로 적음.

구체적 선택은 [ADR-20260220](ADR/ADR-20260220.md) 참고.

### 3.2 에셋 메타데이터 UI

- 백엔드/API는 이미 `metadata` 지원.
- 프론트: 에셋 생성·수정 시 `metadata` 입력/수정 필드 추가 (키-값 또는 JSON 등).

### 3.3 시뮬레이션 API·엔진

- ADR-20260218에 따라 시뮬레이션 엔진은 Backend 내부 모듈로 구현 예정.
- 관계/그래프 모델 확장 후, "그래프 순회·상태 전파" 등 시뮬레이션 로직 설계 및 API 연동.

---

## 4. 단계별 개발 계획

### Phase 1: 관계 모델 확장 (데이터·API)

- **목표**: 관계의 종류·방향·관계 단위 속성을 저장·조회할 수 있게 함.
- **작업**:
  - 관계 모델 설계 확정 (ADR-20260220 반영).
  - MongoDB 컬렉션/스키마 및 init 스크립트 반영.
  - Backend: Relationship(또는 확장된 connections) 엔티티·DTO·Repository·API.
  - `shared/api-schemas` 및 필요 시 이벤트 스키마 업데이트.
- **완료 기준**: API로 관계 타입·방향·속성을 생성·수정·조회할 수 있음.

### Phase 2: 에셋 메타데이터 UI

- **목표**: 에셋 생성·수정 시 메타데이터를 UI에서 입력·수정 가능하게 함.
- **작업**:
  - 에셋 생성/수정 폼에 metadata 입력 필드 추가 (키-값 또는 JSON).
  - 기존 API 그대로 사용.
- **완료 기준**: UI에서 metadata를 넣어 생성/수정한 에셋이 목록·상세에 반영됨.

### Phase 3: 시뮬레이션 기본 연동

- **목표**: "시뮬레이션 실행" 버튼이 백엔드 시뮬레이션 API를 호출하고, 최소한의 시뮬레이션 동작이 이루어짐.
- **작업**:
  - Backend: Simulation 도메인/유스케이스/Controller (ADR-20260218 구조 참고).
  - 시뮬레이션 입력: 에셋·관계(그래프) 조회.
  - 시뮬레이션 결과: 상태 전파 또는 이벤트 발생 등 최소 시나리오 구현 (예: Kafka publish).
  - Frontend: 시뮬레이션 실행 버튼 → API 호출 및 상태 표시.
- **완료 기준**: UI에서 시뮬레이션 실행 시 백엔드가 그래프/에셋을 사용한 시뮬레이션을 수행하고 결과가 확인 가능함.

### Phase 4 (선택): 관계 UI 및 시뮬레이션 고도화

- 관계 생성/수정 전용 UI.
- 시뮬레이션 파라미터(시간, 스텝 등) 입력 및 결과 시각화.

---

## 5. 참고 문서

- [ADR-20260218: ML 파이프라인 및 시뮬레이션 엔진 위치 결정](../ADR/ADR-20260218.md)
- [ADR-20260219: MVP 구현 완료 및 Docker Compose 통합](../ADR/ADR-20260219.md)
- [ADR-20260220: 에셋 관계 모델 확장](../ADR/ADR-20260220.md)
- [README](../../README.md) — 컨셉과 용도
- [infrastructure/mongo/MODEL.md](../../infrastructure/mongo/MODEL.md) — 현재 MongoDB 모델

---
